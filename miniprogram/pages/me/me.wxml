<view class="main">
    <view class="header">
        <!-- ä¸ªäººé¡µé¢å¤´éƒ¨åŒºåŸŸ -->
        <view class="page-title" bindlongpress="onLongPressTitle">ä¸ªäººä¸­å¿ƒ</view>
    </view>


    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{roleLoading}}" class="loading-container">
        <view class="loading-text">æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯</view>
    </view>

    <!-- ç®¡ç†åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
    <view class="management-section">
        <!-- åå°ç®¡ç†æŒ‰é’® -->
        <view wx:if="{{permissions.canViewBackend}}" class="mgmt-btn backend-btn" bindtap="toBackend">
            <view class="btn-icon">ğŸª</view>
            <view class="btn-content">
                <view class="btn-text">åå°ç®¡ç†</view>
                <view class="btn-desc">å•†å“ç®¡ç†ã€è®¢å•å¤„ç†ã€æ•°æ®ç»Ÿè®¡</view>
            </view>
        </view>

        <!-- è®¢å•ç®¡ç†æŒ‰é’® -->
        <view wx:if="{{permissions.canViewOrderManage}}" class="mgmt-btn order-btn" bindtap="toOrderManage">
            <view class="btn-icon">ğŸ“‹</view>
            <view class="btn-content">
                <view class="btn-text">è®¢å•ç®¡ç†</view>
                <view class="btn-desc">æŸ¥çœ‹æ‰€æœ‰è®¢å•ã€å¤„ç†è®¢å•çŠ¶æ€</view>
            </view>
        </view>

        <!-- éª‘æ‰‹é…é€æŒ‰é’® -->
        <view wx:if="{{permissions.canViewRiderManage}}" class="mgmt-btn rider-btn" bindtap="toRiderManage">
            <view class="btn-icon">ğŸšš</view>
            <view class="btn-content">
                <view class="btn-text">éª‘æ‰‹é…é€</view>
                <view class="btn-desc">é…é€ä»»åŠ¡ç®¡ç†</view>
            </view>
        </view>
    </view>

    <!-- åœ°å€ç®¡ç† -->
    <view class="address-box">
        <view class="address-manage">
            <navigator url="/pages/address/address">åœ°å€ç®¡ç†</navigator>
        </view>
        <view wx:if="{{hasAddress}}" class="address-list">
            <view>å§“åï¼š{{address.name}}</view>
            <view>ç”µè¯ï¼š{{address.phone}}</view>
            <view>å®¿èˆæ¥¼ï¼š{{address.detail}}</view>
        </view>
    </view>

    <!-- æˆ‘çš„è®¢å• -->
    <view class="orders-box">
        <view class="orders-header">
            <text class="orders-title">æˆ‘çš„è®¢å•</text>
            <text class="orders-count" wx:if="{{orders.length > 0}}">({{orders.length}})</text>
        </view>
        
        <!-- ç©ºè®¢å•çŠ¶æ€ -->
        <view class="empty-orders" wx:if="{{orders.length === 0}}">
            <view class="empty-icon">ğŸ“¦</view>
            <view class="empty-text">æš‚æ— è®¢å•</view>
            <view class="empty-tip">å¿«å»é€‰è´­æ‚¨å–œæ¬¢çš„æ°´æœå§~</view>
        </view>
        
        <!-- è®¢å•åˆ—è¡¨ -->
        <view class="orders-list" wx:for="{{orders}}" wx:key="index">
            <!-- è®¢å•å¤´éƒ¨ä¿¡æ¯ -->
            <view class="order-header">
                <view class="order-number">è®¢å•å·ï¼š{{item.orderNumber || 'æ— '}}</view>
                <view class="order-status {{item.finished ? 'status-completed' : (item.sending ? 'status-shipping' : (item.paySuccess ? 'status-paid' : 'status-unpaid'))}}">
                    <text wx:if="{{item.finished}}">âœ… å·²é€è¾¾</text>
                    <text wx:elif="{{item.sending}}">ğŸšš é…é€ä¸­</text>
                    <text wx:elif="{{item.paySuccess}}">ğŸ’° å·²æ”¯ä»˜</text>
                    <text wx:else>â³ å¾…æ”¯ä»˜</text>
                </view>
            </view>

            <!-- æ—¶é—´ä¿¡æ¯ -->
            <view class="order-time">
                <view wx:if="{{item.orderTime}}">ä¸‹å•æ—¶é—´ï¼š{{item.orderTime}}</view>
                <view wx:if="{{item.payTime && item.paySuccess}}">æ”¯ä»˜æ—¶é—´ï¼š{{item.payTime}}</view>
                <view wx:if="{{item.sendingTime && item.sending}}">å‘è´§æ—¶é—´ï¼š{{item.sendingTime}}</view>
                <view wx:if="{{item.finishedTime && item.finished}}">é€è¾¾æ—¶é—´ï¼š{{item.finishedTime}}</view>
            </view>

            <!-- å•†å“åˆ—è¡¨ -->
            <view class="order-products">
                <view class="products-title">å•†å“æ¸…å•ï¼š</view>
                <view class="product-item" wx:for="{{item.fruitList}}" wx:for-item="fruitArr" wx:key="fruit">
                    <text class="product-name">{{fruitArr[0]}}</text>
                    <text class="product-quantity">Ã—{{fruitArr[1]}}</text>
                    <text class="product-price" wx:if="{{fruitArr[2]}}">ï¿¥{{fruitArr[2]}}</text>
                </view>
            </view>

            <!-- é…é€ä¿¡æ¯ -->
            <view class="order-address" wx:if="{{item.name && item.phone}}">
                <view class="address-info">
                    <text class="address-label">æ”¶è´§äººï¼š</text>
                    <text>{{item.name}} {{item.phone}}</text>
                </view>
                <view class="address-detail" wx:if="{{item.detail}}">
                    <text class="address-label">åœ°å€ï¼š</text>
                    <text>{{item.detail}}</text>
                </view>
            </view>
                
            <!-- è®¢å•åº•éƒ¨ -->
            <view class="orders-footer">
                <view class="total-amount">
                    <text class="amount-label">å®ä»˜é‡‘é¢ï¼š</text>
                    <text class="amount-value">ï¿¥{{item.total}}</text>
                </view>
            </view>
        </view>
    </view>
</view>