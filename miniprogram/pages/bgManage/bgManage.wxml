<!-- è“ç‰™æ‰“å°æœºæ§åˆ¶é¢æ¿ -->
<view class='bluetooth-panel'>
  <view class='bluetooth-status-row'>
    <text class='status-text'>æ‰“å°æœºçŠ¶æ€ï¼š</text>
    <text class='status-value {{connectedDevice ? "connected" : "disconnected"}}'>
      {{connectedDevice ? connectedDevice.name || 'å·²è¿æ¥' : 'æœªè¿æ¥'}}
    </text>
    <button class='control-btn search-btn' bindtap='searchBluetoothDevices' disabled='{{isConnecting}}' wx:if='{{!connectedDevice}}'>
      {{isConnecting ? 'è¿æ¥ä¸­...' : 'æœç´¢æ‰“å°æœº'}}
    </button>
    <button class='control-btn disconnect-btn' bindtap='disconnectBluetooth' disabled='{{!connectedDevice}}' wx:if='{{connectedDevice}}'>
      æ–­å¼€è¿æ¥
    </button>
  </view>
</view>

<!-- è‡ªåŠ¨å‘è´§æ§åˆ¶é¢æ¿ -->
<view class='auto-shipping-panel'>
  <view class='panel-title'>ğŸšš è‡ªåŠ¨å‘è´§è®¾ç½®</view>
  <view class='setting-item'>
    <text class='setting-label'>è‡ªåŠ¨å‘è´§ï¼š</text>
    <switch class='setting-switch' checked='{{autoShippingEnabled}}' bindchange='toggleAutoShipping'></switch>
    <text class='setting-status'>{{autoShippingEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}}</text>
  </view>
  <view class='setting-item'>
    <text class='setting-label'>è‡ªåŠ¨æ‰“å°ï¼š</text>
    <switch class='setting-switch' checked='{{autoPrintEnabled}}' bindchange='toggleAutoPrint'></switch>
    <text class='setting-status'>{{autoPrintEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}}</text>
  </view>
  <view class='setting-description'>
    <text class='description-text'>â€¢ è‡ªåŠ¨å‘è´§ï¼šå·²æ”¯ä»˜è®¢å•å°†è‡ªåŠ¨æ›´æ–°ä¸ºå‘è´§çŠ¶æ€</text>
    <text class='description-text'>â€¢ è‡ªåŠ¨æ‰“å°ï¼šå‘è´§å‰è‡ªåŠ¨æ‰“å°è®¢å•ï¼ˆéœ€è¿æ¥æ‰“å°æœºï¼‰</text>
    <text class='description-text'>â€¢ æ£€æŸ¥é¢‘ç‡ï¼šæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡å¾…å‘è´§è®¢å•</text>
  </view>
</view>

<!-- è“ç‰™è®¾å¤‡é€‰æ‹©å¼¹çª— -->
<view class='bluetooth-modal' wx:if='{{showBluetoothModal}}'>
  <view class='modal-mask' bindtap='toggleBluetoothModal'></view>
  <view class='modal-content'>
    <view class='modal-header'>
      <text class='modal-title'>é€‰æ‹©æ‰“å°æœº</text>
      <text class='modal-close' bindtap='toggleBluetoothModal'>Ã—</text>
    </view>
    <view class='modal-body'>
      <view wx:if='{{bluetoothDevices.length === 0}}' class='no-devices'>
        <text>æœªå‘ç°æ‰“å°æœºè®¾å¤‡</text>
        <text class='hint'>è¯·ç¡®ä¿æ‰“å°æœºå·²å¼€å¯å¹¶å¤„äºå¯è¿æ¥çŠ¶æ€</text>
      </view>
      <view wx:else class='device-list'>
        <view wx:for='{{bluetoothDevices}}' wx:key='deviceId' class='device-item' 
              bindtap='connectBluetoothDevice' data-device-id='{{item.deviceId}}'>
          <view class='device-info'>
            <text class='device-name'>{{item.name || 'æœªçŸ¥è®¾å¤‡'}}</text>
            <text class='device-id'>{{item.deviceId}}</text>
          </view>
          <text class='device-signal'>{{item.RSSI}}dBm</text>
        </view>
      </view>
    </view>
    <view class='modal-footer'>
      <button class='modal-btn cancel-btn' bindtap='toggleBluetoothModal'>å–æ¶ˆ</button>
      <button class='modal-btn search-btn' bindtap='searchBluetoothDevices'>é‡æ–°æœç´¢</button>
    </view>
  </view>
</view>

<!-- è®¢å•æœç´¢é¢æ¿ -->
<view class='search-panel' wx:if="{{cardNum === 4}}">
  <view class='search-container'>
    <input class='search-input' 
           placeholder='è¾“æ‰‹æœºå·åå››ä½æœç´¢è®¢å•' 
           value='{{searchPhone}}' 
           bindinput='onSearchInput'
           type='number'
           maxlength='4' />
    <button class='search-btn' bindtap='searchOrderByPhone'>æœç´¢</button>
    <button class='clear-btn' bindtap='clearSearch' wx:if='{{searchPhone}}'>æ¸…ç©º</button>
  </view>
  <view class='search-result' wx:if='{{searchResult.length > 0}}'>
    <text class='result-text'>æ‰¾åˆ° {{searchResult.length}} æ¡è®¢å•</text>
  </view>
  <view class='no-result' wx:if='{{showNoResult}}'>
    <text class='no-result-text'>æœªæ‰¾åˆ°ç›¸å…³è®¢å•</text>
  </view>
</view>

<view class='tapCard'>
  <view class="addCard {{cardNum === 1 ? 'tapOn':'tapOff'}} " bindtap='tapTo1'>å·²æ”¯ä»˜</view>
  <view class="delCard {{cardNum === 2 ? 'tapOn':'tapOff'}} " bindtap='tapTo2'>å·²æ‰“å•</view>
  <view class="deliver {{cardNum === 3 ? 'tapOn':'tapOff'}} " bindtap='tapTo3'>å·²é€è¾¾</view>
  <view class="deliver {{cardNum === 4 ? 'tapOn':'tapOff'}} " bindtap='tapTo4'>æ‰€æœ‰è®¢å•</view>
</view>

<!-- å·²æ”¯ä»˜ -->
<view class='addFruit' wx:if="{{cardNum === 1}}">

<view class='theList'>

  <view class="weui-cells weui-cells_after-title">

    <view wx:for="{{displayOrderList}}" wx:key="idx" class='listItem' wx:if="{{item.paySuccess && !item.sending}}">
      <view class='f_column'>
        <view>è®¢å•å·ï¼š{{item.orderNumber || 'æ— '}}</view>
        <view>{{item.name}}</view>
        <view>{{item.phone}}</view>
        <view>{{item.schoolName}}/{{item.addressItem}}/{{item.detail}}</view>
        <view>æ€»ä»·ï¼š{{item.total}}</view>
        <view>è®¢å•å†…å®¹ï¼š</view>
        <view wx:for="{{item.fruitList}}" wx:for-item="fruitArr" wx:key="fruit">{{fruitArr[0]}} Ã— {{fruitArr[1]}}</view>
        <view>å¤‡æ³¨ï¼š{{item.message}}</view>
        <view>ä¸‹å•æ—¶é—´ï¼š{{item.orderTime}}</view>
      </view>

      <view class='Btns'>
        <view class='downBtn' bindtap='boxFruit' id="{{item._id}}">å‘è´§</view>
      </view>
    </view>

  </view>

</view>
</view>

<!-- å·²å‘è´§ -->
<view class='addFruit' wx:if="{{cardNum === 2}}">

<view class='theList'>

  <view class="weui-cells weui-cells_after-title">
    <view wx:for="{{displayOrderList}}" wx:key="idx" class='listItem' wx:if="{{item.sending && !item.finished}}">
        <view class='f_column'>
        <view>è®¢å•å·ï¼š{{item.orderNumber || 'æ— '}}</view>
        <view>{{item.name}}</view>
        <view>{{item.phone}}</view>
        <view>{{item.schoolName}}/{{item.addressItem}}/{{item.detail}}</view>
        <view>æ€»ä»·ï¼š{{item.total}}</view>
        <view>è®¢å•å†…å®¹ï¼š</view>
        <view wx:for="{{item.fruitList}}" wx:for-item="fruitArr" wx:key="fruit">{{fruitArr[0]}} Ã— {{fruitArr[1]}}</view>
        <view>å¤‡æ³¨ï¼š{{item.message}}</view>
        <view>å‘è´§æ—¶é—´ï¼š{{item.sendingTime}}</view>
      </view>

      <view class='Btns'>
        <view class='upBtn' bindtap='sendingFruit' id="{{item._id}}">é€è¾¾</view>
      </view>
    </view>
  </view>

</view>
</view>

<!-- å·²é€è¾¾ -->
<view class='addFruit' wx:if="{{cardNum === 3}}">

<view class='theList'>

  <view class="weui-cells weui-cells_after-title">
    <view wx:for="{{displayOrderList}}" wx:key="idx" class='listItem' wx:if="{{item.finished}}">
        <view class='f_column'>
        <view>è®¢å•å·ï¼š{{item.orderNumber || 'æ— '}}</view>
        <view>{{item.name}}</view>
        <view>{{item.phone}}</view>
        <view>{{item.schoolName}}/{{item.addressItem}}/{{item.detail}}</view>
        <view>æ€»ä»·ï¼š{{item.total}}</view>
        <view>è®¢å•å†…å®¹ï¼š</view>
        <view wx:for="{{item.fruitList}}" wx:for-item="fruitArr" wx:key="fruit">{{fruitArr[0]}} Ã— {{fruitArr[1]}}</view>
        <view>å¤‡æ³¨ï¼š{{item.message}}</view>
        <view>é€è¾¾æ—¶é—´ï¼š{{item.finishedTime}}</view>
      </view>
    </view>
  </view>

</view>
</view>

<!-- æ‰€æœ‰è®¢å• -->
<view class='addFruit' wx:if="{{cardNum === 4}}">

<view class='theList'>

  <view class="weui-cells weui-cells_after-title">
    <view wx:for="{{displayOrderList}}" wx:key="pay" class='listItem'>
      <view class='f_column'>
        <view>{{item.name}}</view>
        <view>{{item.phone}}</view>
        <view>{{item.schoolName}}/{{item.addressItem}}/{{item.detail}}</view>
        <view>æ€»ä»·ï¼š{{item.total}}</view>
        <view>è®¢å•å†…å®¹ï¼š</view>
        <view wx:for="{{item.fruitList}}" wx:for-item="fruitArr" wx:key="fruit">{{fruitArr[0]}} Ã— {{fruitArr[1]}}</view>
        <view>å¤‡æ³¨ï¼š{{item.message}}</view>
        <view>ä¸‹å•æ—¶é—´ï¼š{{item.orderTime}}</view>
        <view>é€è¾¾æ—¶é—´ï¼š{{item.finishedTime}}</view>
        <view wx:if="{{item.paySuccess}}">æ”¯ä»˜çŠ¶æ€ï¼šå·²æ”¯ä»˜</view>
        <view wx:if="{{item.finished}}">é€è¾¾çŠ¶æ€ï¼šå·²é€è¾¾</view>
        <view wx:if="{{item.paySuccess && !item.sending}}">çŠ¶æ€ï¼šå·²æ”¯ä»˜/å¾…å‘è´§</view>
        <view wx:if="{{item.sending && !item.finished}}">çŠ¶æ€ï¼šå·²å‘è´§</view>
      </view>
    </view>
  </view>

</view>
</view>


