# 模拟打印机功能测试文档

## 功能迁移概述

已成功将模拟打印机连接功能从首页（homepage）迁移到订单管理页面（bgManage），实现了更合理的功能布局。

## 迁移内容

### 1. UI界面变更

**订单管理页面新增：**
- 模拟打印机控制面板
- 连接/断开按钮
- 连接状态显示
- 设备名称显示

**首页移除：**
- setupMockPrinter() 方法
- 模拟下单成功提示中的打印机状态信息

### 2. 功能逻辑迁移

**新增方法（bgManage.js）：**
- `connectMockPrinter()` - 连接模拟打印机
- `disconnectMockPrinter()` - 断开模拟打印机
- `checkMockPrinterStatus()` - 检查模拟打印机连接状态

**数据字段新增：**
- `mockPrinterConnected` - 模拟打印机连接状态
- `mockPrinterDevice` - 模拟打印机设备信息

## 测试步骤

### 1. 模拟打印机连接测试
1. 打开订单管理页面
2. 查看蓝牙打印机控制面板下方的"模拟打印机"区域
3. 点击"连接模拟打印机"按钮
4. 验证：
   - 按钮变为"断开模拟打印机"
   - 显示"✅ 模拟打印机已连接"
   - 显示设备名称"模拟热敏打印机"
   - 弹出成功提示

### 2. 模拟打印机断开测试
1. 在已连接状态下，点击"断开模拟打印机"按钮
2. 验证：
   - 按钮变为"连接模拟打印机"
   - 连接状态信息消失
   - 弹出断开成功提示

### 3. 状态持久化测试
1. 连接模拟打印机
2. 退出订单管理页面
3. 重新进入订单管理页面
4. 验证：连接状态应该保持

### 4. 自动打印功能测试
1. 确保模拟打印机已连接
2. 在首页进行模拟下单
3. 验证：
   - 订单应该自动触发打印
   - 控制台应该显示模拟打印内容
   - 包含订单场景信息

### 5. 手动打印功能测试
1. 确保模拟打印机已连接
2. 在订单管理页面选择一个订单进行打印
3. 验证：
   - 应该执行模拟打印
   - 控制台显示详细打印信息

## 功能特点

### 1. 智能状态管理
- 页面加载时自动检查连接状态
- 状态持久化存储
- 与真实蓝牙打印机状态独立管理

### 2. 完整的模拟体验
- 模拟真实的连接/断开流程
- 详细的打印内容输出
- 包含订单场景信息显示

### 3. 兼容性保证
- 与现有蓝牙打印机功能完全兼容
- 不影响真实打印机的连接和使用
- 保持原有的自动打印逻辑

## 代码变更总结

### 文件修改列表
1. `miniprogram/pages/bgManage/bgManage.wxml` - 新增模拟打印机UI
2. `miniprogram/pages/bgManage/bgManage.wxss` - 新增模拟打印机样式
3. `miniprogram/pages/bgManage/bgManage.js` - 新增模拟打印机逻辑
4. `miniprogram/pages/homepage/homepage.js` - 移除模拟打印机相关代码

### 关键实现点
- 使用 `mockDevice: true` 标记模拟设备
- 通过本地存储实现状态持久化
- 在页面生命周期中检查连接状态
- 保持与现有打印逻辑的兼容性

## 预期效果

用户现在可以在订单管理页面方便地控制模拟打印机的连接状态，实现更好的功能组织和用户体验。模拟打印机功能完全独立于真实蓝牙打印机，可以用于开发和测试环境。